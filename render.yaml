# Render Blueprint for VoiceFlow CRM
# One-click deployment to Render
# Documentation: https://render.com/docs/blueprint-spec
#
# IMPORTANT: After deployment, you MUST set these environment variables in Render Dashboard:
# - MONGODB_URI (MongoDB Atlas connection string)
# - ELEVENLABS_API_KEY
# - TWILIO_ACCOUNT_SID and TWILIO_AUTH_TOKEN
# - STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, and all price IDs
# - SMTP credentials (SMTP_USER, SMTP_PASSWORD, etc.)

services:
  # Backend API Service
  - type: web
    name: voiceflow-crm-api
    runtime: node
    region: oregon
    plan: starter
    branch: main
    buildCommand: cd backend && npm install
    startCommand: cd backend && npm start
    healthCheckPath: /api/health

    envVars:
      - key: NODE_ENV
        value: production

      - key: PORT
        value: 5001

      # Database - SET IN RENDER DASHBOARD
      - key: MONGODB_URI
        sync: false

      # Redis - Can use Render Redis or Redis Cloud
      - key: REDIS_URI
        sync: false

      # JWT - Auto-generated
      - key: JWT_SECRET
        generateValue: true

      - key: JWT_EXPIRE
        value: 7d

      # Application URLs - Update after custom domain setup
      - key: CLIENT_URL
        value: https://voiceflow-app.onrender.com

      - key: API_URL
        value: https://voiceflow-api.onrender.com

      # ElevenLabs - SET IN RENDER DASHBOARD
      - key: ELEVENLABS_API_KEY
        sync: false

      - key: ELEVENLABS_PHONE_NUMBER_ID
        sync: false

      - key: ELEVENLABS_LEAD_GEN_AGENT_ID
        sync: false

      - key: ELEVENLABS_BOOKING_AGENT_ID
        sync: false

      - key: ELEVENLABS_COLLECTIONS_AGENT_ID
        sync: false

      - key: ELEVENLABS_PROMO_AGENT_ID
        sync: false

      - key: ELEVENLABS_SUPPORT_AGENT_ID
        sync: false

      # AI Providers (Optional - for AI Assistant features)
      # Only one is needed, configure in Render Dashboard
      - key: OPENAI_API_KEY
        sync: false

      - key: ANTHROPIC_API_KEY
        sync: false

      - key: GOOGLE_AI_API_KEY
        sync: false

      # Twilio - SET IN RENDER DASHBOARD
      - key: TWILIO_ACCOUNT_SID
        sync: false

      - key: TWILIO_AUTH_TOKEN
        sync: false

      - key: TWILIO_PHONE_NUMBER
        sync: false

      # Stripe LIVE keys - SET IN RENDER DASHBOARD
      - key: STRIPE_SECRET_KEY
        sync: false

      - key: STRIPE_PUBLISHABLE_KEY
        sync: false

      - key: STRIPE_WEBHOOK_SECRET
        sync: false

      - key: STRIPE_STARTER_PRICE_ID
        sync: false

      - key: STRIPE_PROFESSIONAL_PRICE_ID
        sync: false

      - key: STRIPE_ENTERPRISE_PRICE_ID
        sync: false

      # Email - SET IN RENDER DASHBOARD
      - key: SMTP_HOST
        value: smtp.gmail.com

      - key: SMTP_PORT
        value: 587

      - key: SMTP_SECURE
        value: false

      - key: SMTP_USER
        sync: false

      - key: SMTP_PASSWORD
        sync: false

      - key: SMTP_FROM_EMAIL
        sync: false

      - key: SMTP_FROM_NAME
        value: VoiceFlow CRM

      # Security
      - key: RATE_LIMIT_WINDOW
        value: 15

      - key: RATE_LIMIT_MAX_REQUESTS
        value: 100

      - key: SESSION_SECRET
        generateValue: true

      - key: COOKIE_SECURE
        value: true

      - key: COOKIE_SAME_SITE
        value: strict

      - key: CORS_ORIGINS
        value: https://voiceflow-app.onrender.com,https://app.voiceflow.ai

      # Feature Flags
      - key: ENABLE_SIGNUP
        value: true

      - key: ENABLE_GOOGLE_AUTH
        value: false

      - key: ENABLE_TRIAL
        value: true

      - key: TRIAL_DAYS
        value: 14

  # Frontend Static Site
  - type: web
    name: voiceflow-crm-app
    runtime: static
    branch: main
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/dist

    routes:
      - type: rewrite
        source: /*
        destination: /index.html

    headers:
      - path: /*
        name: X-Frame-Options
        value: SAMEORIGIN

      - path: /*
        name: X-Content-Type-Options
        value: nosniff

      - path: /*
        name: X-XSS-Protection
        value: 1; mode=block

      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable

    envVars:
      - key: VITE_API_URL
        value: https://voiceflow-api.onrender.com

      - key: VITE_GOOGLE_CLIENT_ID
        value: 710258787879-qmvg6o96r0k3pc6r47mutesavrhkttik.apps.googleusercontent.com

      - key: VITE_STRIPE_PUBLISHABLE_KEY
        sync: false
