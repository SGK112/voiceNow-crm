<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Studio - VoiceNow CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a0b 50%, #000000 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* Dot grid overlay - matches marketing */
        .dot-grid {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.12) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Dark card style - matches marketing */
        .dark-card {
            background: linear-gradient(135deg, rgba(15, 15, 16, 0.95) 0%, rgba(26, 26, 27, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            overflow: hidden;
        }

        .dark-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #3b82f6 100%);
        }

        .dark-card:hover {
            border-color: rgba(59, 130, 246, 0.4);
        }

        /* Glass card */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Social cards */
        .social-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .social-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }

        /* Platform badges */
        .platform-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; }
        .facebook { background: #1877f2; color: white; }
        .linkedin { background: #0077b5; color: white; }
        .twitter { background: #1da1f2; color: white; }
        .general { background: #6366f1; color: white; }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* FAB button */
        .fab-create {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 90;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .fab-create:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(59, 130, 246, 0.6);
        }

        /* Action sheets */
        .action-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(15, 15, 16, 0.98) 0%, rgba(26, 26, 27, 0.98) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-bottom: none;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 200;
            max-height: 90vh;
            overflow-y: auto;
        }

        .action-sheet::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #3b82f6 100%);
            border-radius: 24px 24px 0 0;
        }

        .action-sheet::after {
            content: '';
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .action-sheet.show {
            transform: translateY(0);
        }

        @media (min-width: 768px) {
            .action-sheet {
                max-width: 500px;
                left: 50%;
                transform: translate(-50%, 100%);
                border-radius: 24px;
                border: 1px solid rgba(59, 130, 246, 0.2);
            }

            .action-sheet.show {
                transform: translate(-50%, 0);
                bottom: 24px;
            }
        }

        /* Overlay */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 150;
        }

        .overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        /* Filter tabs */
        .filter-tab {
            transition: all 0.2s;
        }

        .filter-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
        }

        /* Share buttons */
        .share-btn {
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
        }

        /* Create options */
        .create-option {
            transition: all 0.2s;
        }

        .create-option:hover {
            transform: translateY(-4px);
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        /* Grid responsive */
        @media (min-width: 640px) {
            #content-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 1024px) {
            #content-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (min-width: 1280px) {
            #content-grid { grid-template-columns: repeat(4, 1fr); }
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Dot grid background -->
    <div class="dot-grid"></div>

    <!-- Header - matches app navigation -->
    <header class="sticky top-0 z-50 border-b border-blue-500/20" style="background: linear-gradient(135deg, rgba(15, 15, 16, 0.95) 0%, rgba(26, 26, 27, 0.95) 100%); backdrop-filter: blur(20px);">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <!-- Logo - matches marketing exactly -->
                <a href="/app/dashboard" class="flex items-center gap-3">
                    <span class="flex items-center gap-0.5 h-9 px-2 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg">
                        <span class="w-0.5 h-2 bg-white/80 rounded-full"></span>
                        <span class="w-0.5 h-3.5 bg-white rounded-full"></span>
                        <span class="w-0.5 h-2.5 bg-white/80 rounded-full"></span>
                        <span class="w-0.5 h-4 bg-white rounded-full"></span>
                        <span class="w-0.5 h-2 bg-white/80 rounded-full"></span>
                    </span>
                    <div class="flex items-baseline gap-1">
                        <span class="text-lg font-bold text-white">VoiceNow</span>
                        <span class="text-lg font-bold text-blue-400">Studio</span>
                    </div>
                </a>

                <!-- Navigation -->
                <nav class="flex items-center gap-2">
                    <a href="/app/dashboard" class="hidden sm:flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white rounded-lg text-sm font-medium transition-colors">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="/app/agents" class="hidden sm:flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white rounded-lg text-sm font-medium transition-colors">
                        <i class="fas fa-robot"></i>
                        <span>Agents</span>
                    </a>
                    <a href="/app/crm" class="hidden sm:flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white rounded-lg text-sm font-medium transition-colors">
                        <i class="fas fa-users"></i>
                        <span>CRM</span>
                    </a>
                    <a href="/app/settings" class="flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white rounded-lg text-sm font-medium transition-colors">
                        <i class="fas fa-cog"></i>
                        <span class="hidden sm:inline">Settings</span>
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="relative z-10 max-w-7xl mx-auto px-4 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">

            <!-- Sidebar -->
            <aside class="hidden lg:block">
                <div class="sidebar space-y-4">
                    <!-- Quick Actions -->
                    <div class="dark-card rounded-2xl p-5">
                        <h2 class="text-base font-bold mb-4 text-white">Quick Actions</h2>
                        <div class="space-y-2">
                            <button onclick="Studio.showCreate()" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-semibold text-sm shadow-lg shadow-blue-600/20 hover:shadow-blue-600/30 transition-all">
                                <i class="fas fa-plus mr-2"></i>Create Content
                            </button>
                            <button class="w-full px-4 py-3 bg-white/5 hover:bg-white/10 rounded-xl font-medium text-sm text-left transition-all">
                                <i class="fas fa-magic mr-2 text-purple-400"></i>AI Generate
                            </button>
                            <button class="w-full px-4 py-3 bg-white/5 hover:bg-white/10 rounded-xl font-medium text-sm text-left transition-all">
                                <i class="fas fa-upload mr-2 text-green-400"></i>Upload Media
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="dark-card rounded-2xl p-5">
                        <h3 class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wide">Status</h3>
                        <div class="space-y-1">
                            <button class="filter-btn active w-full px-3 py-2 rounded-lg text-sm font-medium text-left bg-blue-600/20 text-blue-400 transition-all" data-filter="all">
                                All Content <span class="float-right opacity-70" id="count-all">(0)</span>
                            </button>
                            <button class="filter-btn w-full px-3 py-2 rounded-lg text-sm font-medium text-left bg-white/5 hover:bg-white/10 text-gray-300 transition-all" data-filter="ready">
                                Ready <span class="float-right opacity-70" id="count-ready">(0)</span>
                            </button>
                            <button class="filter-btn w-full px-3 py-2 rounded-lg text-sm font-medium text-left bg-white/5 hover:bg-white/10 text-gray-300 transition-all" data-filter="shared">
                                Shared <span class="float-right opacity-70" id="count-shared">(0)</span>
                            </button>
                        </div>

                        <div class="mt-5 pt-5 border-t border-white/10">
                            <h3 class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wide">Platforms</h3>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 cursor-pointer text-sm text-gray-300">
                                    <input type="checkbox" class="platform-filter accent-blue-500" data-platform="instagram" checked>
                                    <i class="fab fa-instagram text-pink-400"></i> Instagram
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer text-sm text-gray-300">
                                    <input type="checkbox" class="platform-filter accent-blue-500" data-platform="facebook" checked>
                                    <i class="fab fa-facebook text-blue-400"></i> Facebook
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer text-sm text-gray-300">
                                    <input type="checkbox" class="platform-filter accent-blue-500" data-platform="linkedin" checked>
                                    <i class="fab fa-linkedin text-blue-500"></i> LinkedIn
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="lg:col-span-3">
                <!-- Hero -->
                <div class="mb-6">
                    <h1 class="text-2xl lg:text-3xl font-bold mb-2">
                        Social Media <span class="gradient-text">Studio</span>
                    </h1>
                    <p class="text-gray-400 text-sm lg:text-base">
                        Create AI images, generate captions, and share across all platforms.
                    </p>
                </div>

                <!-- Mobile Filter Tabs -->
                <div class="flex items-center gap-2 mb-4 overflow-x-auto pb-2 lg:hidden">
                    <button class="filter-tab active flex-shrink-0 px-4 py-2 rounded-lg text-sm font-medium" data-filter="all">
                        All <span class="ml-1 opacity-70" id="mobile-count-all">(0)</span>
                    </button>
                    <button class="filter-tab flex-shrink-0 px-4 py-2 rounded-lg text-sm font-medium bg-white/5" data-filter="ready">
                        Ready <span class="ml-1 opacity-70" id="mobile-count-ready">(0)</span>
                    </button>
                    <button class="filter-tab flex-shrink-0 px-4 py-2 rounded-lg text-sm font-medium bg-white/5" data-filter="shared">
                        Shared <span class="ml-1 opacity-70" id="mobile-count-shared">(0)</span>
                    </button>
                </div>

                <!-- Content Grid -->
                <div id="content-grid" class="grid gap-4">
                    <!-- Content cards will be inserted here -->
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="dark-card rounded-2xl p-12 text-center hidden">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-blue-500/10 flex items-center justify-center">
                        <i class="fas fa-images text-3xl text-blue-400"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">No content yet</h3>
                    <p class="text-gray-400 mb-6 text-sm max-w-md mx-auto">
                        Create your first AI image or upload photos to get started with your social media content.
                    </p>
                    <button onclick="Studio.showCreate()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-semibold shadow-lg shadow-blue-600/20">
                        <i class="fas fa-plus mr-2"></i>Create Content
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- FAB -->
    <button id="fab-create" class="fab-create lg:hidden">
        <i class="fas fa-plus text-white text-xl"></i>
    </button>

    <!-- Overlay -->
    <div id="overlay" class="overlay"></div>

    <!-- Create Content Sheet -->
    <div id="create-sheet" class="action-sheet">
        <div class="pt-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">Create Content</h3>
                <button id="close-create" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div id="create-options" class="grid grid-cols-2 gap-4 mb-4">
                <button id="option-generate" class="create-option dark-card flex flex-col items-center gap-3 p-6 rounded-2xl hover:border-blue-500/40 transition-all">
                    <div class="w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center">
                        <i class="fas fa-sparkles text-2xl text-blue-400"></i>
                    </div>
                    <div class="text-center">
                        <p class="font-bold text-sm text-white">AI Generate</p>
                        <p class="text-xs text-gray-400">Create with AI</p>
                    </div>
                </button>

                <button id="option-upload" class="create-option dark-card flex flex-col items-center gap-3 p-6 rounded-2xl hover:border-green-500/40 transition-all">
                    <div class="w-14 h-14 rounded-full bg-green-500/20 flex items-center justify-center">
                        <i class="fas fa-camera text-2xl text-green-400"></i>
                    </div>
                    <div class="text-center">
                        <p class="font-bold text-sm text-white">Upload Photo</p>
                        <p class="text-xs text-gray-400">From device</p>
                    </div>
                </button>
            </div>

            <div id="generate-form" class="hidden space-y-4">
                <button id="back-to-options" class="text-sm text-gray-400 hover:text-white mb-2">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Describe your image</label>
                    <textarea
                        id="ai-prompt"
                        rows="4"
                        class="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none resize-none text-sm"
                        placeholder="Modern kitchen remodel with black granite countertops, white cabinets..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-300 mb-2">Platform</label>
                        <select id="platform-select" class="w-full bg-black/30 border border-gray-700 rounded-xl px-3 py-2.5 text-sm text-white">
                            <option value="instagram">Instagram</option>
                            <option value="facebook">Facebook</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="general">General</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-300 mb-2">Style</label>
                        <select id="style-select" class="w-full bg-black/30 border border-gray-700 rounded-xl px-3 py-2.5 text-sm text-white">
                            <option value="photorealistic">Photo</option>
                            <option value="artistic">Artistic</option>
                            <option value="cinematic">Cinematic</option>
                        </select>
                    </div>
                </div>

                <button id="generate-submit" class="w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-bold shadow-lg text-sm">
                    <i class="fas fa-magic mr-2"></i>Generate Image
                </button>

                <div id="generate-progress" class="hidden bg-blue-500/10 border border-blue-500/20 rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="animate-spin">
                            <i class="fas fa-circle-notch text-blue-400 text-xl"></i>
                        </div>
                        <span class="text-sm text-blue-300">Creating your image...</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div id="generate-bar" class="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Detail Sheet -->
    <div id="detail-sheet" class="action-sheet">
        <div class="pt-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">Content Details</h3>
                <button id="close-detail" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="detail-content" class="space-y-4">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="image-upload" accept="image/*" capture="environment" class="hidden">

    <script>
        // Studio App
        const Studio = {
            content: [],
            currentContent: null,
            currentFilter: 'all',
            platformFilters: ['instagram', 'facebook', 'linkedin'],

            init() {
                console.log('ðŸŽ¬ Initializing VoiceNow Studio...');
                this.loadFromLocalStorage();
                this.setupEventListeners();
                this.render();
                console.log('âœ… Studio ready!');
            },

            loadFromLocalStorage() {
                const saved = localStorage.getItem('voicenow_studio');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.content = data.content || [];
                }
            },

            saveToLocalStorage() {
                localStorage.setItem('voicenow_studio', JSON.stringify({
                    content: this.content
                }));
            },

            setupEventListeners() {
                // Create buttons
                document.getElementById('fab-create')?.addEventListener('click', () => this.showCreate());
                document.getElementById('close-create')?.addEventListener('click', () => this.hideSheet('create-sheet'));

                // Create options
                document.getElementById('option-generate')?.addEventListener('click', () => {
                    document.getElementById('create-options').classList.add('hidden');
                    document.getElementById('generate-form').classList.remove('hidden');
                });

                document.getElementById('option-upload')?.addEventListener('click', () => {
                    document.getElementById('image-upload').click();
                });

                document.getElementById('back-to-options')?.addEventListener('click', () => {
                    document.getElementById('create-options').classList.remove('hidden');
                    document.getElementById('generate-form').classList.add('hidden');
                });

                // Image upload
                document.getElementById('image-upload')?.addEventListener('change', (e) => this.handleImageUpload(e));

                // Generate submit
                document.getElementById('generate-submit')?.addEventListener('click', () => this.generateContent());

                // Detail sheet
                document.getElementById('close-detail')?.addEventListener('click', () => this.hideSheet('detail-sheet'));

                // Overlay
                document.getElementById('overlay')?.addEventListener('click', () => {
                    this.hideSheet('create-sheet');
                    this.hideSheet('detail-sheet');
                });

                // Filter tabs
                document.querySelectorAll('.filter-tab, .filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filter = e.currentTarget.dataset.filter;
                        this.setFilter(filter);

                        // Update active state
                        document.querySelectorAll('.filter-tab').forEach(b => {
                            b.classList.remove('active');
                            b.classList.add('bg-white/5');
                        });
                        document.querySelectorAll('.filter-btn').forEach(b => {
                            b.classList.remove('active', 'bg-blue-600/20', 'text-blue-400');
                            b.classList.add('bg-white/5', 'text-gray-300');
                        });

                        if (e.currentTarget.classList.contains('filter-tab')) {
                            e.currentTarget.classList.add('active');
                            e.currentTarget.classList.remove('bg-white/5');
                        } else {
                            e.currentTarget.classList.add('active', 'bg-blue-600/20', 'text-blue-400');
                            e.currentTarget.classList.remove('bg-white/5', 'text-gray-300');
                        }
                    });
                });

                // Platform filters
                document.querySelectorAll('.platform-filter').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.updatePlatformFilters();
                        this.render();
                    });
                });
            },

            updatePlatformFilters() {
                this.platformFilters = Array.from(document.querySelectorAll('.platform-filter:checked'))
                    .map(cb => cb.dataset.platform);
            },

            setFilter(filter) {
                this.currentFilter = filter;
                this.render();
            },

            showCreate() {
                this.showSheet('create-sheet');
            },

            showSheet(sheetId) {
                document.getElementById(sheetId)?.classList.add('show');
                document.getElementById('overlay')?.classList.add('show');
                document.body.style.overflow = 'hidden';
            },

            hideSheet(sheetId) {
                document.getElementById(sheetId)?.classList.remove('show');
                document.getElementById('overlay')?.classList.remove('show');
                document.body.style.overflow = '';

                if (sheetId === 'create-sheet') {
                    setTimeout(() => {
                        document.getElementById('create-options')?.classList.remove('hidden');
                        document.getElementById('generate-form')?.classList.add('hidden');
                    }, 300);
                }
            },

            async handleImageUpload(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (e) => {
                    this.addContent({
                        id: Date.now(),
                        imageUrl: e.target.result,
                        type: 'uploaded',
                        status: 'ready',
                        caption: '',
                        hashtags: [],
                        platform: 'instagram',
                        timestamp: Date.now()
                    });

                    this.hideSheet('create-sheet');
                    document.getElementById('image-upload').value = '';
                };
                reader.readAsDataURL(file);
            },

            async generateContent() {
                const prompt = document.getElementById('ai-prompt').value.trim();
                if (!prompt) {
                    alert('Please describe what you want to create!');
                    return;
                }

                const platform = document.getElementById('platform-select').value;
                const style = document.getElementById('style-select').value;

                this.showProgress();

                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch('/api/studio/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ prompt, platform, style })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.addContent({
                            id: Date.now(),
                            imageUrl: data.imageUrl,
                            type: 'generated',
                            status: 'ready',
                            prompt: prompt,
                            caption: data.caption || '',
                            hashtags: data.hashtags || [],
                            platform: platform,
                            timestamp: Date.now()
                        });

                        this.hideProgress();
                        this.hideSheet('create-sheet');
                        document.getElementById('ai-prompt').value = '';
                    } else {
                        throw new Error(data.error || 'Generation failed');
                    }
                } catch (error) {
                    console.error('Generation error:', error);
                    alert('Failed to generate. Please try again.');
                    this.hideProgress();
                }
            },

            addContent(contentData) {
                this.content.unshift(contentData);
                this.saveToLocalStorage();
                this.render();
            },

            showDetail(contentId) {
                this.currentContent = this.content.find(c => c.id === contentId);
                if (!this.currentContent) return;

                const detailHTML = `
                    <div class="relative rounded-xl overflow-hidden mb-4">
                        <img src="${this.currentContent.imageUrl}" class="w-full rounded-xl" alt="Content">
                        <div class="platform-badge ${this.currentContent.platform}">
                            ${this.currentContent.platform}
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Caption</label>
                        <textarea
                            id="edit-caption"
                            rows="4"
                            class="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-sm text-white resize-none focus:border-blue-500 focus:outline-none"
                            placeholder="Write your caption...">${this.currentContent.caption || ''}</textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Hashtags</label>
                        <input
                            id="edit-hashtags"
                            type="text"
                            class="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-2 text-sm text-white focus:border-blue-500 focus:outline-none"
                            placeholder="#remodel #homeimprovement"
                            value="${(this.currentContent.hashtags || []).join(' ')}">
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-300 mb-3">Share to:</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="Studio.share('instagram')" class="share-btn instagram text-white text-sm">
                                <i class="fab fa-instagram"></i> Instagram
                            </button>
                            <button onclick="Studio.share('facebook')" class="share-btn facebook text-white text-sm">
                                <i class="fab fa-facebook"></i> Facebook
                            </button>
                            <button onclick="Studio.share('sms')" class="share-btn bg-green-600 text-white text-sm">
                                <i class="fas fa-sms"></i> SMS
                            </button>
                            <button onclick="Studio.share('email')" class="share-btn bg-red-600 text-white text-sm">
                                <i class="fas fa-envelope"></i> Email
                            </button>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button onclick="Studio.downloadContent()" class="flex-1 px-4 py-3 bg-green-600 hover:bg-green-700 rounded-xl font-semibold text-sm transition-colors">
                            <i class="fas fa-download mr-2"></i>Download
                        </button>
                        <button onclick="Studio.deleteContent(${this.currentContent.id})" class="px-4 py-3 bg-red-600/20 border border-red-600/40 text-red-400 hover:bg-red-600/30 rounded-xl transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;

                document.getElementById('detail-content').innerHTML = detailHTML;
                this.showSheet('detail-sheet');
            },

            share(platform) {
                const caption = document.getElementById('edit-caption')?.value || '';
                const hashtags = document.getElementById('edit-hashtags')?.value || '';

                this.currentContent.caption = caption;
                this.currentContent.hashtags = hashtags.split(' ').filter(h => h.startsWith('#'));
                this.currentContent.status = 'shared';
                this.saveToLocalStorage();
                this.render();

                alert(`Sharing to ${platform}!`);
                this.hideSheet('detail-sheet');
            },

            downloadContent() {
                const link = document.createElement('a');
                link.download = `voicenow-content-${Date.now()}.png`;
                link.href = this.currentContent.imageUrl;
                link.click();
            },

            deleteContent(id) {
                if (confirm('Delete this content?')) {
                    this.content = this.content.filter(c => c.id !== id);
                    this.saveToLocalStorage();
                    this.hideSheet('detail-sheet');
                    this.render();
                }
            },

            showProgress() {
                document.getElementById('generate-progress')?.classList.remove('hidden');
                const submitBtn = document.getElementById('generate-submit');
                if (submitBtn) submitBtn.disabled = true;

                let width = 0;
                const interval = setInterval(() => {
                    width += 5;
                    if (width > 90) width = 90;
                    const bar = document.getElementById('generate-bar');
                    if (bar) bar.style.width = width + '%';
                }, 200);
                this.progressInterval = interval;
            },

            hideProgress() {
                clearInterval(this.progressInterval);
                const bar = document.getElementById('generate-bar');
                if (bar) bar.style.width = '100%';
                setTimeout(() => {
                    document.getElementById('generate-progress')?.classList.add('hidden');
                    if (bar) bar.style.width = '0%';
                    const submitBtn = document.getElementById('generate-submit');
                    if (submitBtn) submitBtn.disabled = false;
                }, 500);
            },

            getFilteredContent() {
                let filtered = this.content;

                if (this.currentFilter !== 'all') {
                    filtered = filtered.filter(c => c.status === this.currentFilter);
                }

                if (this.platformFilters.length > 0) {
                    filtered = filtered.filter(c => this.platformFilters.includes(c.platform));
                }

                return filtered;
            },

            render() {
                const grid = document.getElementById('content-grid');
                const emptyState = document.getElementById('empty-state');
                const filtered = this.getFilteredContent();

                if (filtered.length === 0) {
                    grid?.classList.add('hidden');
                    emptyState?.classList.remove('hidden');
                } else {
                    grid?.classList.remove('hidden');
                    emptyState?.classList.add('hidden');

                    if (grid) {
                        grid.innerHTML = filtered.map(item => `
                            <div class="social-card dark-card rounded-2xl overflow-hidden cursor-pointer" onclick="Studio.showDetail(${item.id})">
                                <div class="relative aspect-square bg-gray-900">
                                    <img src="${item.imageUrl}"
                                         class="w-full h-full object-cover"
                                         alt="Content"
                                         loading="lazy">
                                    <div class="platform-badge ${item.platform}">${item.platform}</div>
                                    ${item.status === 'shared' ? '<div class="absolute top-2 left-2"><span class="px-2 py-1 bg-green-500 text-white text-xs rounded-full font-bold">âœ“ Shared</span></div>' : ''}
                                </div>
                                <div class="p-4">
                                    <p class="text-sm text-gray-300 mb-2 line-clamp-2">${item.caption || item.prompt || 'No caption'}</p>
                                    <div class="flex items-center justify-between text-xs text-gray-500">
                                        <span>${new Date(item.timestamp).toLocaleDateString()}</span>
                                        <span>${item.hashtags?.length || 0} tags</span>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                }

                this.updateCounts();
            },

            updateCounts() {
                const all = this.content.length;
                const ready = this.content.filter(c => c.status === 'ready').length;
                const shared = this.content.filter(c => c.status === 'shared').length;

                // Desktop counts
                const countAll = document.getElementById('count-all');
                const countReady = document.getElementById('count-ready');
                const countShared = document.getElementById('count-shared');
                if (countAll) countAll.textContent = `(${all})`;
                if (countReady) countReady.textContent = `(${ready})`;
                if (countShared) countShared.textContent = `(${shared})`;

                // Mobile counts
                const mobileCountAll = document.getElementById('mobile-count-all');
                const mobileCountReady = document.getElementById('mobile-count-ready');
                const mobileCountShared = document.getElementById('mobile-count-shared');
                if (mobileCountAll) mobileCountAll.textContent = `(${all})`;
                if (mobileCountReady) mobileCountReady.textContent = `(${ready})`;
                if (mobileCountShared) mobileCountShared.textContent = `(${shared})`;
            }
        };

        document.addEventListener('DOMContentLoaded', () => Studio.init());
    </script>
</body>
</html>
